#!/bin/bash

# Set correct permissions
chmod 750 /etc/sudoers.d
chmod 750 /etc/polkit-1/rules.d
chgrp polkitd /etc/polkit-1/rules.d
chmod -v 750 /root

# Clean up unnecessary files
rm -vf /etc/sudoers.d/g_wheel
rm -vf /etc/sddm.conf.d/autologin.conf
rm -vf /etc/polkit-1/rules.d/49-nopasswd_global.rules
rm -vf /root/{.automated_script.sh,.zlogin}

# Update GRUB configuration
sed -i 's/GRUB_DISTRIBUTOR=.*/GRUB_DISTRIBUTOR="ArchPK"/' /etc/default/grub

# Remove 'splash' and 'quiet' from GRUB_CMDLINE_LINUX_DEFAULT
sed -i 's/\s*splash\s*//g' /etc/default/grub
sed -i 's/\s*quiet\s*//g' /etc/default/grub

# Remove the 'plymouth' hook from mkinitcpio.conf
sed -i 's/plymouth//g' /etc/mkinitcpio.conf
sed -i 's/\s\{2,\}/ /g' /etc/mkinitcpio.conf

# Regenerate initramfs and GRUB configuration
mkinitcpio -P
grub-mkconfig -o /boot/grub/grub.cfg

# Remove unnecessary scripts and files
rm -vf /usr/local/bin/{ArchPK-finalisation,livecd-sound,Installation_guide}
rm -f /usr/local/bin/welcome.py

# Remove .desktop files for the welcome app
rm -f /usr/share/applications/welcome.desktop
rm -f /etc/xdg/autostart/welcome.desktop
rm -f /etc/skel/.config/autostart/welcome.desktop
